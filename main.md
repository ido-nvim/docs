# Main
The main module of Ido. This module contains all the internal variables used by Ido, the sandboxing mechanics, and the entry point to the Ido narrowing function.

First of all load the module

```lua
local main = require("ido.main")
```

## `main.variables`
The table of internal variables used by Ido.

| Name | Description | Default value |
| ---- | ----------- | ------------- |
| `before` | The part of the query text before the cursor | `""` |
| `after` | The part of the query text after the cursor | `""` |
| `items` | The table of items which are being matched against the query | `{}` |
| `results` | The items which match the query | `{}` |
| `selected` | The index of the selected item | `0` |
| `suggestion` | The suggestion string | `""` |
| `bindings` | The bindings in `getchar()` format, generated from `config.options.keys` | `{}` |
| `looping` | Whether the event loop of Ido is running | `false` |

## `main.sandbox`
The sandboxed environment of Ido.

| Name | Description |
| ---- | ----------- |
| `before` | The sandboxed internal variables of Ido |
| `options` | The sandboxed [options](config.md) of Ido |

When Ido is started, it sandboxes every single variable and option. This is done because when the event loop of Ido is running, it constantly changes the internal variables. Therefore once Ido has stopped running, how can we ensure that the variables are reset to default?

- When Ido exits, reset the variables

This is a good solution except a teeny tiny problem, what if user presses `<C-c>`?

- When Ido starts, reset the variables

This is a better solution, but how do we know the default options to reset to?

- Sandbox

This is an improvement of the previous solution. When Ido sandboxes the variables and options, it just does a `deepcopy` on the originals and stores them in the sandbox. That way we always have a solid way to reset the variables and options.

This creates an ultimonium, which set of options to set, the one described in the [configuration](config.md) documentation, or their sandboxed versions? The answer is simple:

- If Ido is running, and you wish to affect the current instance, change the sandboxed versions

- If you wish to change the default values to fallback to, change the default versions

## `main.insert(STRING)`
This is the fallback function for the loop function as described in the documentation for the [event loop](event.md) of Ido. It essentially inserts a string before the virtual cursor, and fetches results.

Params:
- `STRING` The string to insert before the cursor

Advices:
- `append_string` Append the string to `main.sandbox.variables.before`

- `fetch_results` Fetch results after appending the string

## `main.map(KEYS)`
Take a table containing the key definitions in the human readable `key-notation` format of vim, and convert it to the notation generated by `getchar()`. This is the function which populates the `main.sandbox.variables.bindings` variable.

Params:
- `KEYS` Dictionary of key definitions to translate to keycodes

## `main.start(FIELDS)`
Start the Ido narrowing interface. It does quite a lot of things

- Does some UI settings behind the hood to make Ido feel native to Neovim
- Sandboxes the variables and options
- Generates keycode-based keymaps by calling `main.map()`
- Loads the module options, in case the currently running Ido instance is a module
- Starts the event loop
- Returns a value on accepting it
- Returns an empty string (`""`) on not accepting anything

Params:
- `FIELDS` Unified way to set the sandboxed options and variables

Returns:
- The accepted result, if there is any
- `""` in case nothing was accepted
